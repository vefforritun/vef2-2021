---
title: Fyrirlestur 11.1 ‚Äî Upprifjun
---

# Fyrirlestur 11.1 ‚Äî Upprifjun

## Vefforritun 2 ‚Äî HBV403G

### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## Node.js

* [Node.js](https://nodejs.org/) er platform bygg√∞ur √° V8 til a√∞ sm√≠√∞a hr√∂√∞, skalanleg netforrit
* Notar atbur√∞adrifi√∞, ekki-blokkandi I/O m√≥del sem gerir √æa√∞ l√©tt, skilvirkt og fullkomi√∞ fyrir raunt√≠ma forrit sem me√∞h√∂ndla mikil g√∂gn yfir dreif√∞ kerfi
 Notum til a√∞ b√∫a til allskonar forrit, b√¶√∞i _bakenda_, _CLI_ o.fl.

***

## Atbur√∞adrifi√∞

* Node.js forrit eiga a√∞ vera atbur√∞adrifin‚Äîerfitt a√∞ skrifa √æau ekki √æannig
* Gefum upp _callback_ fall fyrir hluti sem taka t√≠ma, kalla√∞ √≠ √æa√∞ √æegar a√∞ger√∞ kl√°rast
* Allar a√∞ger√∞ir √≠ core sem gera eitthva√∞ √≠ lengri t√≠ma taka vi√∞ callback

***

## Blokk

* _Blokk_ er √æa√∞ sem gerist ef vi√∞ keyrum k√≥√∞a sem keyrir lengi √°n √æess a√∞ leyfa event loop a√∞ halda √°fram
* Leyfum √∂√∞rum hlutum ekki a√∞ gerast √° me√∞an‚Äîforriti√∞ okkar hangir, er blokka√∞
* √û.a. ef vi√∞ blokkum √° me√∞an vi√∞ b√≠√∞um eftir I/O, minni, neti o.sfr., √æ√° blokkar **allt** node.js keyrsluumhverfi√∞

***

## Ekki-blokkandi I/O ‚Äì Async I/O

* I/O er √≥tr√∫lega h√¶gt m.v. anna√∞ sem vi√∞ gerum
* √ûegar vi√∞ bi√∞jum um I/O √≠ Node.js sendum vi√∞ atbur√∞i sem ver√∞a keyr√∞ir √æegar st√Ωrikerfi er b√∫i√∞
* √ûurfum √æv√≠ ekki a√∞ b√≠√∞a! Gerum eitthva√∞ nytsamlegt √° me√∞an

***

## Callbacks

* Lang flest API √≠ node.js taka vi√∞ callbacks
  - Hafa formi√∞ `function (err, data) { }`
* Ef villa kom upp er `err` `truthy` og inniheldur uppl√Ωsingar um villu
* Annars eru ni√∞urst√∂√∞ur √≠ `data`

***

## async & await

* Getum nota√∞ `async` og `await` sem getur flatt k√≥√∞ann okkar
* Ver√∞um a√∞ hafa `async`¬†fall utan um k√≥√∞a, t.d. me√∞ `main` falli
* √ûa√∞ fall ver√∞ur a√∞ promise, √æurfum a√∞ setja `catch` √° √æa√∞ til a√∞ gr√≠pa allar villur

---

## npm

* npm er _pakkastj√≥ri_ (package manager) fyrir JavaScript
  - leyfir okkur l√≠ka a√∞ setja upp og nota allskonar t√≥l sem skrifu√∞ eru me√∞ JavaScript
* Sett upp me√∞ _[node.js](https://nodejs.org/)_

***

## `package.json`

* JSON skr√° sem [skilgreinir _allskonar_ var√∞andi verkefni√∞ okkar](https://docs.npmjs.com/cli/v6/configuring-npm/package-json)
* √ç grunninn √æ√≥ uppl√Ωsingar um hva√∞a pakka vi√∞ notum
* Ef vi√∞ gefum √∫t pakkann skilgreinum vi√∞ l√Ωsig√∂gn √≠ `package.json`

***

## `package-lock.json`

* NPM √∫tb√Ωr `package-lock.json` me√∞ uppl√Ωsingum um alla pakka sem s√≥ttir voru
  * og pakka sem √æeir s√≥ttu o.s.fr.
* Skr√°ir √∫tg√°fur af _√∂llum_ √æessum p√∂kkum

***
## √ötg√°fun√∫mer

npm notar [_semantic versioning_](https://semver.org/) (semver) til a√∞ tilgreina √∫tg√°fun√∫mer √° forminu `major.minor.patch`, t.d. `1.2.3`

***

* `major` er h√¶kka√∞ ef vi√∞ gerum breytingar sem breyta API, t.d. breytum nafni √° falli
* `minor` er h√¶kka√∞ ef vi√∞ b√¶tum vi√∞ virkni √°n √æess a√∞ breyta fyrirliggjandi API (backwards compatible)
* `patch` er h√¶kka√∞ ef vi√∞ l√∂gum villur √°n √æess a√∞ breyta fyrirliggjandi API (backwards compatible)

***

## npm √≥kostir?

* En hefur npm √≥kosti?
* Seinustu √°r hafa komi√∞ upp atvik √æar sem pakkar hafa horfi√∞ √∫r npm og haft √°hrif √° _√æ√∫sundir_ verkefna
* Getur veri√∞ varasamt a√∞ taka √° sig of m√∂rg dependancy

***

## Einingar

* Getum og _√¶ttum a√∞_ skipta forritunum okkar upp √≠ einingar
* Me√∞ √æv√≠ ver√∞ur...
  - au√∞veldara er a√∞ hugsa um forriti√∞
  - au√∞veldara a√∞ vinna me√∞ _fl√¶kjustig_

***

## Einingar √≠ Node.js

* Einingakerfi√∞ √≠ Node.js byggir √≠ grunninn √° [CommonJS](http://www.commonjs.org/specs/modules/1.0/)
  - Var√∞ til √æegar f√≥lk f√≥r a√∞ nota JavaScript utan vafra og √æurfti lei√∞ til a√∞ pakka saman virkni
  - Hle√∞ur einingum _synchronously_
* Sn√Ωst um a√∞ _exporta_ g√∂gnum √∫r einingum og s√¶kja me√∞ `require`

***

## import og export

* ECMAScript 2015 skilgreinir a√∞ra lei√∞ me√∞ _import_ og _export_: ES modules
  * [G√≥√∞ur stu√∞ningur √≠ v√∂frum](https://caniuse.com/es6-module-dynamic-import)
  * L√≠ka [`<script type="module">`](https://caniuse.com/es6-module)

***

Node.js hefur stu√∞ning ef vi√∞ [fylgjum reglum sem a√∞skilja commonjs fr√° ES modules](https://nodejs.org/api/esm.html#esm_modules_ecmascript_modules):

* Skr√°r ver√∞a a√∞ hafa endinguna `.mjs` til a√∞ geta nota√∞
* Ver√∞um a√∞ v√≠sa √≠ skr√° me√∞ endingu
  * `import { data } from './lib.mjs`
* Ef vi√∞ h√∂fum m√∂ppu √æar sem `package.json` inniheldur `{ "type": "module" }` getum vi√∞ nota√∞ ‚Äûvenjulega‚Äú endingu `.js`

***

## Skj√∂lun eininga

* JSDoc er ein til a√∞ skjala JavaScript k√≥√∞a
  - Svipar til JavaDoc
* Margar lei√∞ir til a√∞ merkja k√≥√∞a
  - http://usejsdoc.org/
* Gott a√∞ nota frekar en a√∞ b√∫a eitthva√∞ til sj√°lf

---

## Express

* [Express: Fast, unopinionated, minimalist web framework for Node.js](https://expressjs.com/)
* Sm√°tt √≠ sni√∞um en gefur mikla m√∂guleika √° a√∞ b√¶ta vi√∞ virkni til a√∞ gera h√©r um bil hva√∞ sem er
* `npm install express --save`

***

## [Request hluturinn](https://expressjs.com/en/4x/api.html#req)

* `req` stendur fyrir HTTP request sem kemur fr√° client
  - Getum sk√Ωrt anna√∞ (t.d. `request` e√∞a `foo`) me√∞ √æv√≠ a√∞ sk√Ωra argument anna√∞
* Hefur b√¶√∞i eigindi og f√∂ll

***

## [Response hluturinn](https://expressjs.com/en/4x/api.html#res)

* `res` stendur fyrir HTTP response sem vi√∞ erum a√∞ skila til client
* Hefur b√¶√∞i eigindi og f√∂ll

***

## Route

* Express hefur [stu√∞ning vi√∞ routing](https://expressjs.com/guide/routing.html)
* _Route_ eru sl√≥√∞ (URL) sem forriti√∞ okkar svarar bei√∞num fr√° client √°
  - Passar vi√∞ HTTP a√∞ger√∞ir

***

## Express Router

* Getum b√∫i√∞ til route √°n √æess a√∞ hafa `app` me√∞ √æv√≠ a√∞ nota `const router = express.Router()`
  - Exportum s√≠√∞an `router`
* Skiptum forriti upp √≠ einingar √æar sem hver s√©r um √°kve√∞in hluta af routes

***

## Middleware √≠ Express

* Middleware er k√≥√∞i sem s√©r um einhvern part af √æv√≠ a√∞ √∫tb√∫a svar
  - Getur b√¶tt einhverjum g√∂gnum vi√∞ fyrir √∂nnur middleware
  - S√©√∞ um innskr√°ningu
  - Logga√∞ hva√∞ er a√∞ gerast
  - o.fl.

***

* Middleware hefur a√∞gang a√∞ request og response hlutum og _n√¶sta_ middleware
  - `function middleware(req, res, next)`
* Getur
  - Keyrt k√≥√∞a
  - Breytt `req` e√∞a `res`
  - Enda√∞ request-response keyrslu
  - Kalla√∞ √≠ n√¶sta middleware

***

## Templating

* Til a√∞ birta s√≠√∞u √æurfum vi√∞ a√∞ hafa √∫tlit fyrir hana ‚Äì eitthva√∞ √°kve√∞i√∞ HTML
* Ekki skilvirkt a√∞ √∫tb√∫a sj√°lf HTML me√∞ √æv√≠ a√∞ setja saman strengi
* Template leyfa okkur a√∞ √∫tb√∫a √∫tlit √≥h√°√∞ virkni, vi√∞ f√°um g√∂gn og vi√∞ birtum √æau √° √°kve√∞inn h√°tt
* M√∂rg template m√°l til, t.d.
  - Pug, EJS, Handlebars, Mustache

---

## HTTP grunnur

* [HTTP 1.1](http://tools.ietf.org/html/rfc2068) miki√∞ nota√∞ √≠ dag
  - √û√≥ √æa√∞ s√© or√∞i√∞ 22 √°ra
* [HTTP/2](https://tools.ietf.org/html/rfc7540) komi√∞ yfir ca. 50% notkun √≠ heiminum  
  - [Um 50.2% notkun √≠ jan√∫ar 2021](https://w3techs.com/technologies/details/ce-http2/all/all)
* Notar TCP/IP fyrir gagnafluttning
* DNS (Domain Name System) √æ√Ω√∞ir IP-t√∂lur √≠ l√©n

***

## Request‚Äîresponse

* HTTP byggir √° request‚Äîresponse milli client og server
* Client sendir request √° server
* Server framkv√¶mir a√∞ger√∞ir og sendir response √° client

***

## HTTP a√∞fer√∞ir

* HTTP Request √æarf a√∞ hafa a√∞fer√∞/s√∂gn tilgreinda
* HTTP 1.0 skilgreindi GET, POST og HEAD
* HTTP 1.1 b√¶tti vi√∞ OPTIONS, PUT, DELETE, TRACE og CONNECT

***

## Headers/hausar

* Sendir b√¶√∞i √≠ request og response
* Heiti og gildi √≠ texta, a√∞skili√∞ me√∞ tv√≠punkt
  - `Connection: close`

***

## URL

URL samanstendur af:

* Pr√≥tokol, tv√≠punkti & tveimur sk√°strikum
* Host, venjulega domain nafn e√∞a IP tala
* Hugsanlega tv√≠punkti og port-n√∫meri, ef ekki skilgreint er port 80 nota√∞

***

* Sl√≥√∞ √° au√∞lind
* Hugsanlega query-streng, name-value safn, skipt me√∞ &
* Hugsanlega fragment identifier, sta√∞setning innan au√∞lindar

---

## HTTP a√∞fer√∞ir og `<form>`

* √ûegar vi√∞ b√∫um til `<form>` getum vi√∞ skilgreint hvort vi√∞ notum `GET` e√∞a `POST` me√∞ `method` attribute
* `<form method="get">` sendir g√∂gn me√∞ `GET` og setur allar breytur √≠ query-string, t.d. `http://example.org/?data=123`
* `<form method="post">` sendir g√∂gn me√∞ `POST` og setur allar breytur √≠ _request body_

***

## Express og POST

* POST g√∂gn koma sem straumur
  * `req` er [EventEmitter](https://nodejs.org/api/events.html#events_events)
* Ekki jafn handh√¶gt og a√∞ lesa GET g√∂gn

***

## enctype

`enctype` √° formi segir til um hvernig g√∂gn √≠ formi eru enk√≥√∞u√∞ (_encoding type_)

* `application/x-www-form-urlencoded` sj√°lfgefi√∞, g√∂gn eru URL enk√≥√∞u√∞ (t.d. `√≥` ver√∞ur `%C3%B3`) me√∞ `&` √° milli reita (`<input>`, `<select>`, `<textarea>`)

***

* `text/plain`, ekki er √°tt vi√∞ g√∂gnin, √æau eru sett sem `key=value` me√∞ `\n` √° milli reita
* `multipart/form-data`, g√∂gnum er streymt yfir me√∞ _boundaries_, notum √æegar vi√∞ h√∂fum `<input type="file">`

***

## body-parser middleware

* Vesen a√∞ vinna me√∞ `POST` g√∂gn gegnum straum √≠ hvert skipti
* Express 4.16+ hefur [`urlencoded` parser middleware til a√∞ vinna me√∞ `application/x-www-form-urlencoded`](http://expressjs.com/en/api.html#express.urlencoded) g√∂gn
  - `app.use(express.urlencoded({ extended: true }));`

***

## Unni√∞ me√∞ skr√°r

* Ef vi√∞ viljum taka vi√∞ skr√°m √æurfum vi√∞ eitthva√∞ anna√∞
  - `body-parser` og middleware fr√° express sty√∞ja ekki
  - [‚ÄûThis does not handle multipart bodies, due to their complex and typically large nature.‚Äú](https://github.com/expressjs/body-parser)

***

## Unni√∞ me√∞ g√∂gn

* √ûegar vi√∞ t√∂kum vi√∞ g√∂gnum √∫r formi er √æa√∞ yfirleitt frekar mikil handavinna
* **Ver√∞um** a√∞ sta√∞festa a√∞ g√∂gn s√©u gild √° bakenda
* √âg endurtek: **vi√∞ ver√∞um a√∞ sta√∞festa g√∂gn √° bakenda**

***

## Validation

* Ekki n√≥g a√∞ nota `<input required>` e√∞a √∂nnur ‚Äûvalidation‚Äú attribute
* Ekki heldur n√≥g a√∞ nota JavaScript ‚Äûvalidation‚Äú √° framenda
  * H√¶gt a√∞ breyta t.d me√∞ DevTools e√∞a senda me√∞ cURL
* Treystum **engu** sem kemur fr√° √∂√∞rum

***

## Sanitization

* T√∫lkum √∂ll g√∂gn sem ‚Äû√≥hrein‚Äú (dirty) √æar til hreinsu√∞ (sanitized)
* Hreinsun √° g√∂gnum fr√° notanda √æ.a. √æau innihaldi ekkert sem vi√∞ viljum ekki
* Getur veri√∞ √∂ryggistengt (`xss`) e√∞a fyrir gagnageymslu (fjarl√¶gja bil, sta√∞la g√∂gn √° einhvern m√°ta)

---

## [PostgreSQL](https://en.wikipedia.org/wiki/PostgreSQL)

* E√∞a bara _postgres_
* Open source gagnagrunnur sem er mj√∂g √∫tbreiddur og miki√∞ nota√∞ur
* _Object-relational database management system_ (ORDBMS), miki√∞ af s√©rt√¶kri, kr√∂ftugri virkni
* _ACID_ (atomicity, consistency, isolation, durability) og √∫tf√¶rir mest allan SQL sta√∞alinn

***

## T√∂flur

* T√∂flur samanstanda af d√°lkum og r√∂√∞um
* D√°lkar eru vel skilgreindir me√∞ t√Ωpum, takm√∂rkunum og √Ωmsum √∂√∞rum l√Ωsig√∂gnum
* Ra√∞ir eru √æau g√∂gn sem vi√∞ b√¶tum vi√∞ t√∂fluna
  - Getum haft t√∂flur me√∞ engum r√∂√∞um, upp √≠ tugmilj√≥nir e√∞a fleiri ra√∞ir

***

## Postgres og Node.js

* [node-postgres](https://github.com/brianc/node-postgres) er ‚Äûhrein‚Äú JavaScript √∫tf√¶rsla (notar ekki library √≠ √∂√∞rum forritunarm√°lum) √° PostgreSQL client
* `npm install --save pg`
* Callback og promise vi√∞m√≥t
* Sty√∞ur _prepared statements_ sem vi√∞ notum **alltaf** til a√∞ minnka l√≠kur √° _SQL injection_ √°r√°sum

---

## Heroku

* Platform as a service (PaaS)
  - Keyrir ofan √° AWS (Amazon Web Services)
* Getum keyrt forritin okkar √≠ ‚Äûsk√Ωinu‚Äú
* √ûurfum ekki a√∞ hugsa um a√∞ reka v√©lar
  - Keyrum forriti√∞ okkar sem ‚Äûapp‚Äú

***

## [The Twelve-Factor App](https://12factor.net/)

* Samansafn af 12 atri√∞um sem hj√°lpa okkur a√∞ skrifa forrit sem ‚Äûau√∞velt‚Äú er a√∞ reka
* Br√∫ar a√∞ einhverju leiti bili√∞ √° milli _development_ og _operations_, _devops_
* Byggt √° reynslu √æeirra sem bjuggu til Heroku

***

* [I. Codebase](https://12factor.net/codebase)
* [II. Dependencies](https://12factor.net/dependencies)
* [III. Config](https://12factor.net/config)
* [IV. Backing services](https://12factor.net/backing-services)
* [V. Build, release, run](https://12factor.net/build-release-run)
* [VI. Processes](https://12factor.net/processes)

***

* [VII. Port binding](https://12factor.net/port-binding)
* [VIII. Concurrency](https://12factor.net/concurrency)
* [IX. Disposability](https://12factor.net/disposability)
* [X. Dev/prod parity](https://12factor.net/dev-prod-parity)
* [XI. Logs](https://12factor.net/logs)
* [XII. Admin processes](https://12factor.net/admin-processes)

---

## √ñryggi

* A√∞ m√∂rgu a√∞ huga √æegar kemur a√∞ √æv√≠ a√∞ skrifa √∂rugg forrit
* Jafnvel fleira √æegar kemur a√∞ vefforritum
* OWASP top 10 g√≥√∞ur sta√∞ur til a√∞ byrja

***

## OWASP

* [Open Web Application Security Project](https://www.owasp.org/)
* Opin samt√∂k sem stu√∞la a√∞ √ær√≥un √∂ruggra vefforrita sem h√¶gt er a√∞ treysta
* Halda √∫ti top 10 lista yfir helstu √∂ryggish√¶ttur vefforrita
  - Tekinn saman af s√©rfr√¶√∞ingum √∫t fr√° reynslu og raunverulegum upp√°komum
  - Uppf√¶r√∞ur 2017, fyrsta √∫tg√°fa 2003

***

* [A10:2017 Insufficient Logging and Monitoring](https://github.com/OWASP/Top10/blob/master/2017/en/0xaa-logging-detection-response.md)
* [A9:2017 Using Components with Known Vulnerabilities](https://github.com/OWASP/Top10/blob/master/2017/en/0xa9-known-vulns.md)
* [A8:2017 Insecure Deserialization](https://github.com/OWASP/Top10/blob/master/2017/en/0xa8-insecure-deserialization.md)
* [A7:2017 Cross-Site Scripting (XSS)](https://github.com/OWASP/Top10/blob/master/2017/en/0xa7-xss.md)
* [A6:2017 Security Misconfiguration](https://github.com/OWASP/Top10/blob/master/2017/en/0xa6-security-misconfiguration.md)
* [A5:2017 Broken Access Control](https://github.com/OWASP/Top10/blob/master/2017/en/0xa5-broken-access-control.md)
* [A4:2017 XML External Entities (XXE)](https://github.com/OWASP/Top10/blob/master/2017/en/0xa4-xxe.md)
* [A3:2017 Sensitive Data Exposure](https://github.com/OWASP/Top10/blob/master/2017/en/0xa3-sensitive-data-disclosure.md)

***

## [A2:2017 Broken Authentication](https://github.com/OWASP/Top10/blob/master/2017/en/0xa2-broken-authentication.md)

* √År√°sara√∞ili stelur a√∞gangi annara me√∞ leka e√∞a vegna √∂ryggisgalla
* A√∞ sm√≠√∞a au√∞kenningar og session kerfi r√©tt er **erfitt**
* Galli getur veri√∞ √≠ au√∞kenningunni sj√°lfri, √∫tskr√°ningu, session me√∞h√∂ndlun, gleymdu lykilor√∞s virkni o.s.fr.

***

## [A1:2017 Injection](https://github.com/OWASP/Top10/blob/master/2017/en/0xa1-injection.md)

* Ef g√∂gn fr√° notanda eru ekki sta√∞fest e√∞a hreinsu√∞ √°√∞ur en √æau eru notu√∞ √≠ skipanir getur √æa√∞ leitt til injection √°r√°sa
* √År√°sara√∞ili √∫tb√Ωr texta sem n√Ωtir s√©r galla til a√∞ n√° s√≠nu fram

***

* SQL injection algengast en getur l√≠ka √°tt vi√∞ a√∞ra hluti, XML, SMTP, OS a√∞ger√∞ir o.s.fr.
  - Alls sta√∞ar √æar sem vi√∞ sendum g√∂gn √°fram fr√° notanda inn √≠ √∂nnur kerfi e√∞a sta√∞i √æar sem k√≥√∞i er keyr√∞ur
* Verndum okkur me√∞ √æv√≠ a√∞ treysta aldrei g√∂gnum fr√° notanda, hreinsa inntak, nota parameterized vi√∞m√≥t [o.fl.](https://github.com/OWASP/Top10/blob/master/2017/en/0xa1-injection.md#how-to-prevent)

***

## __Alltaf nota parameterized vi√∞m√≥t__

<!-- eslint-disable no-undef -->

```javascript
const values = ['hall√≥', 'Bobby'];
client.query(
  `INSERT INTO
    test (text, name)
  VALUES
    ($1, $2)`,
  values,
);
```

***

## Hva√∞ eigum vi√∞ a√∞ gera?

* Aldrei treysta neinu fr√° √∂√∞rum
  - Heilbrig√∞ paranoja
* Hva√∞ √°ttu sem a√∞rir vilja?
* Hvernig mun ver√∞a reynt a√∞ n√° √æv√≠?
  - Setjum okkur √≠ spor √°r√°sara√∞ila

---

## Vef√æj√≥nustur

* Margt fellur undir hugtaki√∞ _vef√æj√≥nusta_
* √ç grunninn einhver samskipti milli t√∂lva yfir net
* Veri√∞ til √≠ einhverri mynd s√≠√∞an fari√∞ var a√∞ tengja saman t√∂lvur

***

* W3C skilgreining:
  - "A Web service is a software system designed to support interoperable machine-to-machine interaction over a network"
  - Vef√æj√≥nusta er hugb√∫na√∞arkerfi hanna√∞ til a√∞ eiga samvirk samskipti, v√©l-√≠-v√©l yfir net

***

## HTTP a√∞fer√∞ir

* `GET` ‚Äì bi√∞ur um √∫tg√°fu af tilgreindri au√∞lind, lang mest nota√∞a a√∞fer√∞in
* `HEAD` ‚Äì eins og `GET`, nema vill a√∞eins f√° hausa skilgreinda fyrir au√∞lind
* `POST` ‚Äì Bi√∞ur server um a√∞ taka vi√∞ einingu √≠ request sem n√Ωrri einingu, skilgreinda me√∞ URL. T.d. n√Ωtt svar vi√∞ umr√¶√∞u√ær√¶√∞i e√∞a n√Ω g√∂gn √≠ gagnagrunni

***

* `PUT` ‚Äì bi√∞ur um a√∞ eining √≠ request s√© geymd undir URL, ef √∂nnur er til n√∫ √æegar skal uppf√¶ra hana
* `DELETE` ‚Äì bi√∞ur um a√∞ √æa√∞ sem geymt er √° URL s√© eytt
* `PATCH` ‚Äì uppf√¶rir a√∞eins √æ√° hluta einingar sem sendir eru
* `TRACE` ‚Äì Skilar request til baka, debug
* `OPTIONS` ‚Äì Skilar til baka hva√∞a a√∞fer√∞ir √æj√≥nn sty√∞ur

***

## √ñryggi a√∞ger√∞a

* √Åkve√∞nar a√∞ger√∞ir (t.d. `GET` og `HEAD`) eru skilgreindar sem _√∂ruggar_ a√∞ √æv√≠ leiti a√∞ k√∂ll √≠ √æ√¶r fyrir au√∞lind √° ekki a√∞ breyta neinni st√∂√∞u
* A√∞rar a√∞ger√∞ir (t.d. `POST` og `PUT`) eru √æa√∞ ekki, √æ√¶r munu a√∞ √∂llum l√≠kindum breyta st√∂√∞u √° vef√æj√≥n

***

## Idempotency

* `PUT` og `DELETE` eru a√∞ger√∞ir sem eru _idempotent_, √æ.e.a.s. a√∞ kalla √≠ √æ√¶r m√∂rgum sinnum me√∞ s√∂mu skilyr√∞um hefur s√∂mu √°hrif og a√∞ kalla einu sinni
* `POST` og `PATCH` eru ekki idempotent √æar sem hvert kall getur b√¶tt vi√∞ n√Ωrri einingu e√∞a breytt hluta einingar
* `GET` og `HEAD` eru einnig idempotent √æar sem HTTP er st√∂√∞ulaust

***

## HTTP er st√∂√∞ulaust protocol

* HTTP er st√∂√∞ulaust; √æa√∞ er engin krafa um a√∞ server muni nokkku√∞ √° milli tveggja fyrirspurna fr√° sama client
* Ekkert skrifa√∞ √≠ gagnagrunn, ekkert √° disk, ekkert geymt √≠ minni
  * H√¶gt a√∞ √∫tf√¶ra √æa√∞ samt, en engin krafa √≠ spec!

***

## St√∂√∞uk√≥√∞ar ‚Äî status codes

√ûegar vef√æj√≥nn svarar me√∞ response gefur hann upp st√∂√∞uk√≥√∞a, sem t√∂lu og lesanlegan texta

* `1xx` ‚Äì Til uppl√Ωsinga
* `2xx` ‚Äì Gekk, success
* `3xx` ‚Äì √Åframsending, redirection
* `4xx` ‚Äì Villa hj√° client
* `5xx` ‚Äì Villa hj√° server

***

## REST

* Representational State Transfer, skilgreint √≠ [doktorsritger√∞ Roy Fielding fr√° √°rinu 2000](http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)
* REST er arkitekt√∫rsst√≠ll sem hunsar √∫tf√¶rslu og samskipti en einbl√≠nir √°:
  * hlutverk eininga
  * samskipti √æeirra √° milli
  * takmarkanir √æar √°

***

## REST takmarkanir

√ûa√∞ eru sex skilgreindar takmarkanir √° arkitekt√∫r skv. REST:

1. _Client-server_ ‚Äì samr√¶mt vi√∞m√≥t a√∞skilur client og server
2. _St√∂√∞ulaust_ ‚Äì engin sta√∞a er geymd √° milli bei√∞na
3. _Cacheable_ ‚Äì client getur geymt afrit af svari, sv√∂r ver√∞a √æv√≠ a√∞ skilgreina hvort √æa√∞ megi e√∞a ekki

***

4. _Lagskipt kerfi_ ‚Äì client √æarf ekki a√∞ vita hvort hann s√© tengdur enda server e√∞a hvort hann tengist einhverjum millili√∞
5. _K√≥√∞i eftir √æ√∂rfum_ (ekki krafist) ‚Äì server getur sent k√≥√∞a til client til a√∞ auka virkni hans
6. _Samr√¶mt vi√∞m√≥t_ ‚Äì Grunnur a√∞ h√∂nnun √° REST √æj√≥nustu, einfaldur og a√∞skildur ark√≠tekt√∫r √æ.a. client og server geta vaxi√∞ √≥h√°√∞ hvor √∂√∞rum

***

## Samr√¶mt vi√∞m√≥t

* Au√∞kennum au√∞lindir‚Äîbi√∞jum um au√∞lind og f√°um hana ekki sj√°lfa heldur framsetningu √° henni
  - Bi√∞jum um notanda og f√°um einhverja framsetningu, t.d. sem JSON e√∞a XML √æ√≥ a√∞ vef√æj√≥nn noti √æ√¶r ekki sj√°lfur til a√∞ geyma notanda
* Sj√°lf-l√Ωsandi skilabo√∞, vi√∞ vitum alltaf n√≥g til a√∞ geta unni√∞ me√∞ skilabo√∞in

***

* Vinnum me√∞ au√∞lindir gegnum framsetningu‚Äîclient sem √æekkir framsetningu √° au√∞lind veit n√≥g til a√∞ geta breytt henni
  - Framsettar uppl√Ωsingar um notanda eru n√¶gar til a√∞ vi√∞ getum breytt notanda
* _HATEOAS_

***

## HATEOAS

* Hypermedia As The Engine Of Application State
* Client √æarf engar frekari uppl√Ωsingar en √æ√¶r sem f√°st √≠ byrjun

***

## REST & HTTP

* Vefurinn er st√¶rsta √∫tf√¶rsla √° REST arkitekt√∫r
  - Fielding einn af a√∞alh√∂fundum HTTP
* HTTP skilgreinir caching, au√∞kenningu, content negotiation...

***


## RESTful

* RESTful: notum JSON, HTTP a√∞ger√∞ir og st√∂√∞u k√≥√∞a en l√°tum anna√∞ liggja milli hluta
  - K√≥rr√©tt REST er fl√≥ki√∞
* (√Ütla√∞ur) einfaldleikinn er heillandi, s√©rstaklega √≠ byrjun √æegar f√≥lk var √æreytt √° st√≥rum og miklum XML skj√∂lum
* Gerum okkar besta til a√∞ √∫tb√∫a g√≥√∞ar vef√æj√≥nustur sem er √æ√¶gilegt a√∞ nota

***

## Gallar vi√∞ REST

* Skilgreiningar √° REST milli f√≥lks er mismunandi‚ÄîREST vs RESTful
* L√≠ti√∞ af st√∂√∞lu√∞um t√≥lum sem h√¶gt er a√∞ n√Ωta, REST er ‚Äûof heimspekilegt‚Äú og ekki n√≥gu prakt√≠skt
* Takmarkanir √° HTTP: st√∂√∞u k√≥√∞ar og a√∞ger√∞ir n√° ekki yfir allt sem vi√∞ viljum gera

***

* √ûurfum oft a√∞ gera m√∂rg k√∂ll til a√∞ f√° √∂ll √æau g√∂gn sem okkur vantar
  - Eitt fyrir grein, anna√∞ fyrir h√∂fund, enn anna√∞ fyrir flokk o.s.fr.
* √ç hverju kalli f√°um vi√∞ oft _of_ miki√∞ af uppl√Ωsingum
* GraphQL leysir a√∞ einhverju leiti

***

## H√∂nnun √° vef√æj√≥nustum

* T√∂luvert √≥l√≠kt √æv√≠ a√∞ hanna vefi me√∞ √∫tliti
* Neytendur okkar eru a√∞rir forritarar og √æeirra forrit
  - Mun minna r√Ωmi til a√∞ t√∫lka eitthva√∞ eins og villu √° vef
  - Getum spara√∞ √∂√∞rum _√≥tr√∫lega_ mikinn t√≠ma me√∞ √æv√≠ a√∞ vanda okkur

***

## D√Ωnam√≠skar fyrirspurnir

* Stundum √æurfum vi√∞ a√∞ gr√≠pa til √æess a√∞ b√∫a til fyrirspurnir me√∞ strengjame√∞h√∂ndlun üôà
* Ekki allt getur fari√∞ √≠ prepared statement, t.d. ef vi√∞ viljum d√Ωnam√≠skt breyta `ORDER BY`
* E√∞a gera `PATCH` k√∂ll
* **VER√êUM A√ê FARA VARLEGA**, svona k√≥√∞i er einstaklega vi√∞kv√¶mur fyrir SQL injection

***

## Paging

* √ûegar vi√∞ erum a√∞ vinna me√∞ miki√∞ af g√∂gnum √æurfum vi√∞ oft √° t√≠√∞um a√∞ takmarka hversu miklu er skila√∞
* Ekki v√¶nlegt a√∞ skila √∂llum _milj√≥n_ f√¶rslum til notanda
* Yfirleitt √∫tf√¶rt me√∞ √æv√≠ a√∞ skila _s√≠√∞um_

***

## Gagnam√≥del

* √ûegar vi√∞ setjum upp t√∂flur √≠ gagnagrunn √æurfum vi√∞ a√∞ hugsa um hva√∞a verkefni vi√∞ erum a√∞ leysa
* Hvernig _gagnam√≥deli√∞_ (e. data model) okkar l√≠tur √∫t 
  * Erum a√∞ √∫tb√∫a einfalda√∞a birtingarmynd af raunveruleikanum
* √ûurfum a√∞ √∫tb√∫a tengingar √° milli taflna, nota join

***

* One-to-one
* One-to-many
* Many-to-many

