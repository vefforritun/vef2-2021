---
title: Fyrirlestur 11.2 ‚Äî Upprifjun
---

# Fyrirlestur 11.2 ‚Äî # Upprifjun

## Vefforritun 2 ‚Äî HBV403G

### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## Au√∞kenning

* √ûegar vi√∞ h√∂fum efni sem √° ekki a√∞ vera a√∞gengilegt √∂llum √æurfum vi√∞ einhversskonar _au√∞kenningu_
* Lei√∞ til a√∞ a√∞skilja √° milli ‚Äûalmenns‚Äú, √≥au√∞kennds notanda (e. anonymous user) og √æess sem hefur skr√°√∞ sig

***

## K√∂kur ‚Äì cookies

K√∂kur eru sendar af server til client og eru √æa√∞an √≠ fr√° sendar me√∞ **hverju** request, samanstenda af:

* Nafni & gildi
* Dagsetningu sem kakan rennur √∫t √°
* √Å hva√∞a sl√≥√∞ kakan er sett, t.d. `/`
* ofl.

***

## K√∂kut√Ωpur

* **Session kaka** ‚Äì ef kaka er ekki skilgreind me√∞ dagsetningu er henni eytt √æegar vafra er loka√∞
* **F√∂st kaka** ‚Äì ef √∫reldingardagsetning er skilgreind mun kakan lifa √æa√∞ lengi, √æ√≥ a√∞ sl√∂kkt s√© √° vafra

***

## √ûri√∞ja a√∞ila k√∂kur

* **√ûri√∞ja a√∞ila k√∂kur** ‚Äì ef tv√¶r e√∞a fleiri s√≠√∞ur s√¶kja g√∂gn fr√° sama domain getur √æa√∞ domain sett cookies og vita√∞ hva√∞an komi√∞ er
  - T.d. augl√Ωsendur e√∞a a√∞rar √æj√≥nustur sem selja uppl√Ωsingar um fer√∞ir notanda

***

## Session

* Ef vi√∞ viljum geyma eitthva√∞ magn af g√∂gnum fyrir hvern notanda/client getum vi√∞ nota√∞ _session_
* Einkv√¶mt gildi geymt √≠ k√∂ku sem tengist √° einhvern h√°tt vi√∞ gagnageymslu √° server

***

* Almenn lausn √° einhverju sem er miki√∞ nota√∞
* Engin g√∂gn geymd √≠ k√∂kunni sj√°lfri, a√∞eins v√≠sun
  - Yfirleitt dulk√≥√∞u√∞ og breytt reglulega

---

## Notendaumsj√≥n

* Til √æess a√∞ √∫tf√¶ra notendaumsj√≥n √æurfum vi√∞ b√¶√∞i lei√∞ til a√∞ au√∞kenna og til a√∞ geyma uppl√Ωsingarnar
* √ç grunninn:
  - Au√∞kenni (t.d. notendanafn) og eitthva√∞ leyndarm√°l (e√∞a a√∞rir factorar) sem a√∞eins vi√∞komandi veit (e√∞a hefur)
  - Lei√∞ til a√∞ au√∞kenna sig vi√∞ server, vi√∞halda og vita af √æeirri st√∂√∞u

***

## Notendaumsj√≥n & au√∞kenning

* H√∂fum yfirleitt eitthva√∞ form sem tekur vi√∞ notendanafni og lykilor√∞i, framkv√¶mir `post` √° bakenda, t.d. `/login`
* Bakendi ber saman vi√∞ notendagrunn, ber saman lykilor√∞ og skr√°ir notanda inn e√∞a ekki
  - Innskr√°ningu vi√∞haldi√∞ me√∞ √æv√≠ a√∞ vista √≠ session og √æ.a.l. √≠ cookie hj√° notanda

***

* H√∂fum einhverjar lei√∞ir til a√∞ athuga hvort einhver notandi s√© innskr√°√∞ur og √æ√° hva√∞a notandi √æa√∞ er
  - Notandi sendir cookie me√∞ session uppl√Ωsingum √≠ hverju request
* Notandi getur √∫tskr√°√∞ sig me√∞ √æv√≠ a√∞ t.d. a√∞ gera `get` √° `/logout`
  - Ey√∞ir session cookie

***

## passport.js

* [passport.js](http://www.passportjs.org/) er miki√∞ notu√∞ lei√∞ til a√∞ halda utan um au√∞kenningu me√∞ Express
* Sty√∞ur mismunandi _strategies_ sem segja til um hvernig vi√∞ tengjumst vi√∞ notendagrunn
  - [`local`](https://github.com/jaredhanson/passport-local) leyfir okkur a√∞ nota ‚Äûokkar eigin‚Äú
  - til fyrir [Twitter](https://github.com/jaredhanson/passport-twitter), [Facebook](https://github.com/jaredhanson/passport-facebook), [o.fl.](http://www.passportjs.org/packages/)
* √û√≥nokkrar [stillingar](http://www.passportjs.org/docs/configure/)

***

## Vef√æj√≥nustur & au√∞kenning

* √ûegar vi√∞ b√¶tum au√∞kenningu vi√∞ vef√æj√≥nusturnar okkar er √æa√∞ sjaldan gert me√∞ sessions
* Session geta skalast illa, getur veri√∞ takmarkandi a√∞ hafa eina mi√∞l√¶ga session geymslu
* √ûurfum a√∞ geyma uppl√Ωsingar einhverssta√∞ar √° vef√æj√≥n

***

* Ef vi√∞ notum fleiri en einn vef√æj√≥n √æarf a√∞ deila √æessum uppl√Ωsingum
* √ûurfum a√∞ fletta upp uppl√Ωsingum √≠ gagnageymslu til a√∞ f√° l√Ωsig√∂gn, t.d. hven√¶r session var b√∫i√∞ til
* √ñryggish√¶ttur tengdar cookies og session

***

## Tokens

* Me√∞ √æv√≠ a√∞ nota _tokens_ sem eru undirrita√∞ir af vef√æj√≥n losnum vi√∞ m√∂rg af √æessum vandam√°lum
* Getum st√Ωrt √æv√≠ hva√∞a uppl√Ωsingar eru geymdar
* Au√∞velt a√∞ senda √° milli, t.d. fyrir _single sign-on_ kerfi

***

* G√∂gn sem vi√∞ viljum geyma eru sett saman me√∞ l√Ωsig√∂gnum og stillingum fyrir token
  - T.d. hven√¶r token rennur √∫t
* Vef√æj√≥nn undirritar me√∞ dulk√≥√∞unara√∞fer√∞ og f√∂ldum lykli
* Client f√¶r token og geymir, sendir me√∞ _hverri_ request √æar sem au√∞kenningar er krafist
  - Yfirleitt √≠ `Authorization` HTTP hausnum

***

## JWT

* [JSON Web Tokens](https://jwt.io/) er lei√∞ til a√∞ senda JSON hluti √° milli sta√∞a me√∞ vissu um a√∞ √æeim hafi ekki veri√∞ breytt
* Byggja √° √æv√≠ a√∞ base64 k√≥√∞a uppl√Ωsingar um token, base64 k√≥√∞a uppl√Ωsingar og undirrita me√∞ leyndarm√°li

***

## Caching

* Caching er √æegar vi√∞ geymum g√∂gn √æannig a√∞ √≠ framt√≠√∞inni getum vi√∞ s√≥tt g√∂gnin hra√∞ar
* Alveg fr√° mj√∂g mj√∂g hra√∞virkrar cache virkni innan CPU e√∞a innraminni‚Ä¶
* ‚Ä¶til √æess a√∞ vera nota√∞ √≠ vefforritum til a√∞ hra√∞a sv√∂rum fr√° vef√æj√≥ni

***

## Caching pattern

1. Athugum hvort vi√∞ eigum g√∂gn √≠ cache
2. Ef svo er, skilum cache
3. Annars, framkv√¶mum d√Ωra √∫treikning
4. Setjum ni√∞urst√∂√∞u √≠ cache
5. Skilum ni√∞urst√∂√∞u

***

## redis

* [redis](https://redis.io/) er gagnataga geymsla √≠ minni‚Äîin-memory data structure store
  - Ekki _relational_
  - _NoSQL_
* Sty√∞ur strengi, lista, set og fleiri t√Ωpur

***

## redis

* redis vinnur a√∞eins √≠ skyndiminni og er √æv√≠ mj√∂g hratt
* Getum tengt margar v√©lar saman og unni√∞ √æannig me√∞ miki√∞ af g√∂gnum
* H√¶gt a√∞ kveikja √° a√∞ g√∂gn s√©u vistu√∞ √° disk
* √ç okkar tilfelli munum vi√∞ nota redis fyrir hluti sem ‚Äûmega gleymast‚Äú

---

## fetch

* `node-fetch` veitir okkur a√∞gang a√∞ `fetch` √≠ node
* Byggt √° sama sta√∞li og [`fetch`](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) √≠ vafra
* Promise API!

***

## fetch √° server og client

* Leyfir okkur a√∞ skrifa k√≥√∞a sem virkar b√¶√∞i √≠ vafra og √≠ node
* Kostur √æegar vi√∞ erum a√∞ skrifa k√≥√∞a sem keyrir √° b√°√∞um st√∂√∞um, t.d. react
* K√≥√∞i sem keyrir b√¶√∞i √° server og client (bakenda og framenda) var kalla√∞ur _isomorphic_
* √ç dag kalla√∞ _universal_

***

* Yfirleitt √æegar vi√∞ k√∂llum √≠ `fetch` erum vi√∞ a√∞ kalla √° einhverja vef√æj√≥nustu
* Sl√≥√∞ √° hana breytist eftir √æv√≠ hvort vi√∞ erum √≠ √ær√≥un, √° pr√≥funarserver e√∞a √≠ raunumhverfi
* Viljum √æv√≠ geyma grunnsl√≥√∞ √≠ umhverfi
  - T.d. `API_URL=http://localhost:5000`

***

## Same-origin og CORS

* [Same-origin policy](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy) segir til um a√∞ ekki megi hla√∞a g√∂gnum fr√° annari s√≠√∞u nema protocol, port og host s√© √æa√∞ sama
* Megum √æ√≥ v√≠sa √≠ og nota JavaScript, CSS, myndir o.fl.

---

## Single page application

* Single page application e√∞a _SPA_ eru vefforrit sem, eftir fyrsta load, framkv√¶ma mj√∂g sjaldan ‚Äûrefresh‚Äú
* Vefur hagar s√©r meira eins og desktop forrit
* F√°um n√Ω g√∂gn fr√° vef√æj√≥n me√∞ Ajax e√∞a √°l√≠ka

***

## Grunnhugmynd React

* React byggir √° √æv√≠ a√∞ a√∞skilna√∞ur milli markup √≠ formi template m√°la og l√≥g√≠kar (JavaScript) s√© √≥r√∂kr√©ttur
  - Template m√°l hafa √∂√∞ruv√≠si, ekki jafn kr√∂ftugan syntax
* Markup og l√≥g√≠k eru √≠ e√∞li s√≠nu tengd saman og √æessi a√∞skilna√∞ur byggir _√° t√¶kni_

***

* Highly cohesive
  - Hver hluti inniheldur lang flest sem √æarf til birtingar og notkunar
* Loosely coupled
  - Hver hluti er sj√°lfum s√©r n√¶gur og √æarf ekki a√∞ra hluti

***


## JSX

* JSX er vi√∞b√≥t vi√∞ JavaScript sem leyfir okkur a√∞ l√Ωsa vi√∞m√≥ti
* Blandar saman HTML elementum, React componentum og JavaScript
* Myndar _tr√©_ eins og DOM
* Element sem byrja √° st√≥rum staf eru **React element**

***

## Declarative API

* React hefur _declarative API_
  - Eins og HTML
* Vi√∞ segjum hvernig vi√∞ viljum a√∞ UI s√© og react passar upp√° a√∞ √æa√∞ passi
* √ìl√≠kt _imperative_ API √æar sem vi√∞ framkv√¶mum skref-fyrir-skref √æa√∞ sem √æarf til a√∞ UI s√© r√©tt

***

* Declarative: ‚ÄûBirtu takka sem stendur √° h√¶‚Äú
* Imperative:
  * B√∫√∞u til `button` element
  * B√¶ttu vi√∞ `h√¶` sem texta element innan takka
  * B√¶ttu takka vi√∞ DOM

---

## Components

* Me√∞ √æv√≠ a√∞ nota components getum vi√∞ skipt vi√∞m√≥tinu okkar upp √≠ sj√°lfst√¶√∞ar einingar
  * Mj√∂g sterkt hugtak sem virkar vel
* Getum hugsa√∞ um component eins og fall: tekur vi√∞ `props` (properties) og skilar React element(s)

***

## Afhverju functional yfir class?

* Functional components eru (yfirleitt) einfaldari og l√¶silegri
* Class components nota `this` t√∂luvert sem getur valdi√∞ vandr√¶√∞um √≠ JavaScript
* Me√∞ _react hooks_ geta functional components haft state og _lifecycle_ methods
  * √ûar me√∞ s√∂mu virkni og class components

***

## Conditional Rendering

* Stundum viljum vi√∞ st√Ωra √æv√≠ hva√∞ er rendera√∞ eftir √æv√≠ √≠ hva√∞a st√∂√∞u component er
* Getum:
  - Nota√∞ fl√¶√∞ist√Ωringar √≠ `render`
  - Geymt element √≠ breytu
  - Nota√∞ `&&` (√∫taf short-circuiting)
  - Nota√∞ ternary virkjan `? :`

---

## Atbur√∞ir √≠ React

* Atbur√∞ir √≠ React svipa til DOM atbur√∞a og nota √æ√° ‚Äûundir h√∫ddinu‚Äú
* Festum _beint √° element_ √≠ JSX üôÄ
  * Eitthva√∞ sem vi√∞ l√¶r√∞um √≠ vefforritun 1 a√∞ gera *alls ekki*
* camelCase og f√∂ll en ekki strengir
  * `<button onClick={activateLasers}>` ekki `<button onclick="activateLasers()">`

***

## Argument √≠ event handler

* Til a√∞ senda g√∂gn √≠ event handler getum vi√∞ nota√∞
  - `<button onClick={(e) => this.del(id, e)}>Delete</button>`
  - `<button onClick={this.del.bind(this, id)}>Delete</button>`
* E√∞a vi√∞ getum √∫tb√∫i√∞ handler sem skilar _√∂√∞rum_ handler

***

## State √≠ functional components

* N√Ωlega (fr√° React 16.8, 2019) h√¶gt a√∞ skilgreina state og a√∞ra virkni √°n √æess a√∞ nota class components me√∞ _hooks_
* Kemur ekki √≠ sta√∞inn fyrir classes
* Getur stytt k√≥√∞a t√∂luvert og gert (oftast!) l√¶silegri

***

## Hooks reglur

Ver√∞um a√∞ fylgja [relgum um hooks](https://reactjs.org/docs/hooks-rules.html), lendum annars √≠ vandr√¶√∞um, a√∞allega:

* A√∞eins kalla √≠ hooks yst √≠ falli
  - Ekki √≠ lykkjum, fl√¶√∞ist√Ωringum e√∞a innrif√∂llum
* A√∞eins kalla √≠ hooks √∫r React componentum
  - Ekki √∫r ‚Äûvenjulegum‚Äú JavaScript f√∂llum

***

## Fl√¶√∞i gagna

* Componentum √° a√∞ vera alveg sama hvort a√∞rir componentar hafi st√∂√∞u e√∞a ekki; s√©u functional e√∞a ekki
* `state` er h√°√∞ √∫tf√¶rslu component og er aldrei a√∞gengilegt √∂√∞rum componentum
  - Nema component sendi part af st√∂√∞u √°fram √≠ _prop_ hj√° √∂√∞rum component

---

## useEffect

* Framkv√¶mir hli√∞arverkanir (side effects) √≠ functional component
  * S√¶kja g√∂gn, breyta DOM sj√°lf o.s.fr.

***

## useEffect dependencies

* Oft vitum vi√∞ hven√¶r √æa√∞ √æarf a√∞ keyra hli√∞arverkun aftur, √æurfum ekki a√∞ keyra fyrir hvert render
* Getum sett inn anna√∞ argument: `useEffect(effect, dependencies)`, fylki af breytum sem `effect` byggir √°
* `effect` a√∞eins keyrt ef gildi √≠ `dependencies` hefur breyst

***

## Ref

* `ref` er lei√∞ til a√∞ f√° v√≠sun DOM element
  * Getum samt nota√∞ fyrir a√∞ra hluti l√≠ka, breytur sem eru ekki state √≠ functional component
* B√∫um til breytu fyrir `ref` me√∞ `useRef()` hook
  - `const inputRef = useRef(null);`

---

## Form √≠ react

* Form element sj√° um sitt eigi√∞ state √≠ grunninn:
  - Ef vi√∞ sl√°um inn staf √≠ `<input>` heldur elementi√∞ utan um stafinn og alla sem fylgja
* Passar ekki vi√∞ `state` √≠ react, viljum jafnvel a√∞ react component haldi utan um √æessa st√∂√∞u

***

* Getum stj√≥rna√∞ st√∂√∞u √≠ react me√∞ √æv√≠ a√∞ binda fall vi√∞ form element og geyma st√∂√∞u √æess √≠ `state`
  - React ver√∞ur ‚Äûsingle source of truth‚Äú
  - K√∂llum √æannig component _controlled component_
* Ef vi√∞ h√∂ldum ekki utan um st√∂√∞u √≠ react erum vi√∞ a√∞ nota _uncontrolled component_

***

## Sta√∞a √≠ st√¶rri forritum

* St√¶rri forrit √æurfa yfirleitt a√∞ deila st√∂√∞u √° milli hluta
  - Er notandi innskr√°√∞ur? Er b√∫i√∞ a√∞ s√¶kja g√∂gn?
* Ein lei√∞ er a√∞ ‚Äûlyfta st√∂√∞u‚Äú upp tr√©√∞ og l√°ta sameiginlegt foreldri sj√° um st√∂√∞u fyrir systkini

***

* Sendum f√∂ll √° milli sem b√∂rn kalla √≠ til a√∞ uppf√¶ra st√∂√∞u foreldris sem s√≠√∞an sendir sem prop til annara
  - Getum samt lent √≠ vandr√¶√∞um, hvar h√¶ttum vi√∞? Vita allir af √∂llu?
* Hugtaki√∞ um ‚Äûsingle source of truth‚Äú er mikilv√¶gt √≠ react
  - √ûurfum e.t.v. a√∞ skrifa meiri k√≥√∞a en f√°um f√¶rri b√∂gga √° m√≥ti

---

## TypeScript

* B√¶tir vi√∞ t√Ωpum og athugun √° √æeim √° compile t√≠ma, t√Ωpu √°lyktun (type inference), interfaces, generics og fleira
* TypeScript er ‚Äûsuperset‚Äú af JavaScript, √æ.a. √∂ll JavaScript forrit eru gild TypeScript forrit
* √ûarf a√∞ √æ√Ω√∞a √∫r TypeScript yfir √≠ JavaScript

***

## T√∫lkur

* TypeScript ver√∞ur a√∞ t√∫lka √∫r TypeScript yfir √≠ JavaScript
* Notum a√∞rar skr√°arendingar en fyrir JavaScript
  - `.ts` fyrir TypeScript skr√°r
  - `.tsx` fyrir TypeScript skr√°r sem innihalda jsx

***

## T√Ωpur

* √ûurfum a√∞ vita hva√∞a umhverfi vi√∞ erum a√∞ vinna me√∞ og hva√∞a t√Ωpur √æa√∞ hefur
* T.d. ef vi√∞ reynum a√∞ nota eitthva√∞ s√©rt√¶kt fyrir Node, veit TypeScript ekki af √æv√≠
* Skilgreinum e√∞a s√¶kjum t√Ωpur

***

## Interfaces

* Interfaces eru lei√∞ til a√∞ skilgreina hvernig g√∂gn √≠ hlutum l√≠ta √∫t
* Skilgreinum hvert property me√∞ t√Ωpu og hvort √æa√∞ s√© optional e√∞a ekki
  - Merkjum optional property me√∞ `?`

***

## Optional chaining

* [Optional chaining](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#optional-chaining) me√∞ `?.` virkjanum (optional property accesses virki, l√≠ka kalla√∞ur [_elvis operator_](https://en.wikipedia.org/wiki/Elvis_operator)) leyfir okkur a√∞ s√¶kja gildi sem g√¶tu veri√∞ √≥skilgreind √≠ hlut

***

## Nullish Coalescing

* [Nullish Coalescing](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#nullish-coalescing) me√∞ `??` virkjanum virkar svipa√∞ og short-circuting
* Skilgreindur til a√∞ vera nota√∞ur √æ.a. vi√∞ getum skilgreint gildi √≠ sta√∞ `null` e√∞a `undefind`
  * short-circuiting virkar √° √∂ll `falsy` gildi

***

## Next.js

* Hva√∞ er Next.js
* √ç hvernig verkefni notum vi√∞ √æa√∞
* Hvernig er √æa√∞ √≥l√≠kt Create React App

---

## GraphQL

* [GraphQL er Query m√°l](https://graphql.org/) √ær√≥a√∞ hj√° Facebook kringum 2012
* N√∫na √ær√≥a√∞ √°fram af [GraphQL foundation](https://foundation.graphql.org/)
* A√∞ vissu leiti svar vi√∞ hversu erfitt √æa√∞ getur veri√∞ a√∞ s√¶kja n√°kv√¶mlega √æau g√∂gn sem vi√∞ √æurfum me√∞ REST

---

## Verkefni 1

* Munur √° client side og server side rendering
* Uppsetning √° Express verkefni, skipting √≠ skr√°r, villume√∞h√∂ndlun

***

## Verkefni 2

* Uppsetning √° verkefni me√∞ gagnagrunn
* Fl√¶√∞i √° g√∂gnum √∫r formi, gegnum middleware, validation, santitazion, birting √° villum, skr√°ning √≠ gagnagrunn
* 12 factor app og uppsetning √° Heroku
  * Port √° Express √æj√≥n
  * Gagnagrunnur

***

## Verkefni 3

* Uppsetning √° notendakerfi me√∞ passport
* Uppfletting √° notenda √∫t fr√° g√∂gnum √∫r formi
* bcrypt og lykilor√∞
* Gervig√∂gn b√∫in til fyrir gagnagrunn
* Au√∞kenning og leyfi til a√∞ henda f√¶rslum

***

## Verkefni 4

* ‚ÄûProxy‚Äú virkni
* Uppsetning √° redis og af hverju
* Munur √° fetch √° _client_ og _server_

***

## Verkefni 5

* Uppsetning √° React verkefni
* G√∂gn s√≥tt
  * St√∂√∞ur √° g√∂gnum
  * useEffect og state

***

## Verkefni 6

* Tenging vi√∞ GraphQL, GraphQL fyrirspurnir
* NextJs og TypeScript
* G√∂gn s√≥tt _√° server_‚Äîserver-side rendering

***

## H√≥pverkefni 1

* Notendaumsj√≥n √≠ vef√æj√≥nustusamhengi, passport og jwt
* REST/RESTful vef√æj√≥nustu uppsetning
* Validation og vinnsla me√∞ gagnagrunn √≠ st√¶rra verkefni
